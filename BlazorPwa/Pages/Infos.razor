@page "/infos"
@using BlazorPwa.Services
@inject StudyService StudyService
@inject IJSRuntime JS

<div class="infos-container">
    <header class="header">
        <h1>Infos</h1>
    </header>

    <div class="card" style="text-align: center; background: linear-gradient(135deg, #6366f1 10%, #ec4899 100%); color: white;">
        <div style="font-size: 4rem; margin-bottom: 0.5rem;">
            @GetKawaiiAvatar()
        </div>
        <h2 style="margin-bottom: 0.5rem;">@GetLevelTitle()</h2>
        <p style="opacity: 0.9;">Continue comme √ßa !</p>
    </div>

    <div class="stats-grid">
        <div class="card stat-card">
            <div class="stat-value">@Progress.TotalCardsLearned</div>
            <div class="stat-label">Cartes apprises</div>
        </div>
        <div class="card stat-card">
            <div class="stat-value">@Progress.TotalQuizTaken</div>
            <div class="stat-label">Quiz termin√©s</div>
        </div>
        <div class="card stat-card">
            <div class="stat-value">@Math.Round(Progress.SuccessRate)%</div>
            <div class="stat-label">R√©ussite</div>
        </div>
    </div>

    <div class="card">
        <h3>√Ä propos</h3>
        <p>Cette application a √©t√© con√ßue pour aider les coll√©giens √† r√©viser efficacement gr√¢ce √† la m√©thode des flashcards et des fiches de synth√®se.</p>
    </div>

    <div class="card">
        <h3>Version</h3>
        <p>v1.0.1 (B√™ta)</p>
    </div>

    <div class="card" style="border: 1px solid var(--error);">
        <h3 style="color: var(--error);">Zone de danger</h3>
        <p style="margin-bottom: 1rem;">Si tu veux recommencer √† z√©ro, tu peux effacer toute ta progression ici.</p>
        <button class="btn" style="background: var(--error); color: white; width: 100%;" @onclick="ResetProgress">
            R√©initialiser ma progression
        </button>
    </div>
</div>

@implements IDisposable

@code {
    private BlazorPwa.Models.UserProgress Progress = new();

    protected override async Task OnInitializedAsync()
    {
        StudyService.OnChange += HandleChange;
        await StudyService.LoadProgressAsync();
        await StudyService.CheckForUpdatesAsync();
        Progress = StudyService.GetProgress();
    }

    public void Dispose()
    {
        StudyService.OnChange -= HandleChange;
    }

    private void HandleChange()
    {
        Progress = StudyService.GetProgress();
        StateHasChanged();
    }

    private string GetKawaiiAvatar()
    {
        if (Progress.TotalCardsLearned < 10) return "üå∞"; // Graine/Noisette (Totoro)
        if (Progress.TotalCardsLearned < 50) return "üå±"; // Pousse
        if (Progress.TotalCardsLearned < 100) return "üçÉ"; // Feuilles au vent
        if (Progress.TotalCardsLearned < 200) return "üå≥"; // Grand Arbre
        return "üëª"; // Esprit de la for√™t (Kodama/Totoro style)
    }

    private string GetLevelTitle()
    {
        if (Progress.TotalCardsLearned < 10) return "Petite Noisette";
        if (Progress.TotalCardsLearned < 50) return "Pousse Courageuse";
        if (Progress.TotalCardsLearned < 100) return "Esprit des Feuilles";
        if (Progress.TotalCardsLearned < 200) return "Gardien de l'Arbre";
        return "Totoro Supr√™me";
    }

    private async Task ResetProgress()
    {
        if (await JS.InvokeAsync<bool>("confirm", "Es-tu s√ªr de vouloir tout effacer ? Cette action est irr√©versible !"))
        {
            await StudyService.ResetProgressAsync();
        }
    }
}

<style>
    .infos-container {
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }
    .header {
        margin-bottom: 1rem;
    }
    .card {
        background: white;
        padding: 1.5rem;
        border-radius: var(--radius-lg);
        box-shadow: var(--shadow-sm);
    }
    .card h3 {
        font-size: 1.1rem;
        margin-bottom: 0.5rem;
        color: var(--color-primary-dark);
    }
    .card p, .card li {
        color: var(--color-text);
        font-size: 0.9rem;
        line-height: 1.5;
    }
    .card ul {
        padding-left: 1.2rem;
        margin: 0;
    }
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 0.5rem;
    }
    .stat-card {
        padding: 1rem;
        text-align: center;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
    }
    .stat-value {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--primary);
    }
    .stat-label {
        font-size: 0.7rem;
        color: var(--text-secondary);
        margin-top: 0.25rem;
    }
</style>
